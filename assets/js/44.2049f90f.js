(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{492:function(s,t,a){"use strict";a.r(t);var e=a(2),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("做为一个C#开发者，一直都是基于.net framework框架进行开发，最大的缺点就是不能跨平台，只能局限于windows系统；自从2016年发布.net core1.0版本后，.net core就变成c#开发者未来的开发趋势，可以像java一样部署于各种操作系统中，今天就以web api为例，详细讲解如何将api应用部署到Linux服务器中。")]),s._v(" "),t("h2",{attrs:{id:"打包一个api项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包一个api项目"}},[s._v("#")]),s._v(" 打包一个api项目")]),s._v(" "),t("p",[s._v("1.以自己开发的一个会议系统的api为例；开发工具："),t("code",[s._v("VS2022")]),s._v("，.net core版本："),t("code",[s._v("5.0")]),s._v(";\n.net core有两种打包方式：一种是使用命令行CLI打包，一种是使用视图操作；我们这里选择视图操作，右键web项目点击发布\n"),t("img",{attrs:{src:s.$withBase("/images/dotnet/wx_0705_01.png"),width:"400",height:"300"}})]),s._v(" "),t("p",[s._v("2.选择发布目录"),t("br"),s._v(" "),t("img",{attrs:{src:s.$withBase("/images/dotnet/wx_0705_02.png"),height:"180"}})]),s._v(" "),t("p",[s._v("3.发布配置，部署模式选：框架依赖，目标运行时选：Linux-64，点击保存\n"),t("img",{attrs:{src:s.$withBase("/images/dotnet/wx_0705_03.png"),width:"500",height:"300"}})]),s._v(" "),t("p",[s._v("部署模式参数说明")]),s._v(" "),t("ul",[t("li",[s._v("框架依赖："),t("font",{attrs:{color:"red"}},[s._v("服务器需安装.net core运行时，打包后的文件体积比较小")])],1),s._v(" "),t("li",[s._v("独立："),t("font",{attrs:{color:"red"}},[s._v("服务器无需安装.net core运行时，运行时和项目文件一起打包，打包后的文件体积大")])],1)]),s._v(" "),t("p",[s._v("4.保存配置，发布"),t("br"),s._v(" "),t("img",{attrs:{src:s.$withBase("/images/dotnet/wx_0705_04.png"),height:"300"}})]),s._v(" "),t("h2",{attrs:{id:"上传打包文件到linux服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#上传打包文件到linux服务器"}},[s._v("#")]),s._v(" 上传打包文件到Linux服务器")]),s._v(" "),t("p",[s._v("在服务器新建目录，专门存放web api应用")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("mkdir -p /home/webapi/meeting\n")])])]),t("p",[s._v("使用ftp工具将打包好的文件，上传到"),t("code",[s._v("webapi/meeting")]),s._v(" "),t("img",{attrs:{src:s.$withBase("/images/dotnet/wx_0705_05.png"),height:"300"}})]),s._v(" "),t("h2",{attrs:{id:"安装-net-core运行环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-net-core运行环境"}},[s._v("#")]),s._v(" 安装.net core运行环境")]),s._v(" "),t("p",[s._v("开发环境我们要安装.net core runtime和sdk，在服务器上部署只需要安装runtime就行了")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("yum install -y dotnet-runtime-5.0\n")])])]),t("p",[s._v("运行命令查看是否安装成功，出现如下信息代表安装成功\n"),t("img",{attrs:{src:s.$withBase("/images/dotnet/wx_0705_06.png"),height:"260"}})]),s._v(" "),t("h2",{attrs:{id:"运行-net-core-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行-net-core-api"}},[s._v("#")]),s._v(" 运行.net core api")]),s._v(" "),t("p",[s._v("OK，通过如上操作，运行环境安装好了，项目也打包上传了；现在就只欠把api跑起来了。\n进入api目录，找到*.Web.dll文件\n"),t("img",{attrs:{src:s.$withBase("/images/dotnet/wx_0705_07.png")}})]),s._v(" "),t("p",[s._v("1.直接在当前目录运行"),t("code",[s._v("Ultra.Meeting.Web.dll")]),s._v("，指定端口为6001\n"),t("img",{attrs:{src:s.$withBase("/images/dotnet/wx_0705_08.png")}})]),s._v(" "),t("p",[s._v("出现如上界面表示运行成功。")]),s._v(" "),t("p",[s._v("2.api是跑起来了，但是还有个问题就是，当前会话如果关闭，api进程也会关闭；所以我们要把api应用创建为后台进程（服务）")]),s._v(" "),t("p",[s._v("进入后台进程池目录，创建.service文件")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("cd /etc/systemd/system\ntouch meetingapi.service\n")])])]),t("p",[s._v("编辑meetingapi.service文件，保存")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" meetingapi.service\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Meeting Api By Asp.Net Core\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("User")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Group")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WorkingDirectory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/webapi/meeting\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/dotnet  /home/webapi/meeting/Ultra.Meeting.Web.dll\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RestartSec")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SyslogIdentifier")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("netcore-api\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ASPNETCORE_ENVIRONMENT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Production\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("参数说明")]),s._v(" "),t("ul",[t("li",[s._v("WorkingDirectory  "),t("font",{attrs:{color:"red"}},[s._v("打包文件所在目录")])],1),s._v(" "),t("li",[s._v("Environment  "),t("font",{attrs:{color:"red"}},[s._v("指定ASP.NET CORE的环境变量")])],1),s._v(" "),t("li",[s._v("ExecStart  "),t("font",{attrs:{color:"red"}},[s._v("启动服务执行的命令，分为3部分，中间空格隔开")]),s._v(" "),t("ul",[t("li",[s._v("第一部分 dotnet对应的bin路径")]),s._v(" "),t("li",[s._v("第二部分 *.Web.dll的路径")]),s._v(" "),t("li",[s._v("第三部分 ASP.NET Core中Web主机服务监听的端口--urls")])])],1)]),s._v(" "),t("p",[s._v("3.刷新后台进程，启动服务")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("systemctl daemon-reload\nsystemctl start meetingapi\nsystemctl status meetingapi\n")])])]),t("p",[s._v("出现如下界面，说明后台服务创建并运行成功\n"),t("img",{attrs:{src:s.$withBase("/images/dotnet/wx_0705_09.png")}})]),s._v(" "),t("h2",{attrs:{id:"配置nginx访问swagger文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置nginx访问swagger文档"}},[s._v("#")]),s._v(" 配置Nginx访问swagger文档")]),s._v(" "),t("p",[s._v("上面我们已经成功部署.net core api服务，现在需要验证外网是否能访问api的swagger文档。我们通过Nginx将域名转发到6001端口，Nginx增加如下配置")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("vim")]),s._v(" /usr/local/webserver/nginx/conf/nginx.conf\n\nserver")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl http2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  m-api.luckyzp.top")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v("      cert/9809623_meeting.luckyzp.top.pem")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v("  cert/9809623_meeting.luckyzp.top.key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_ciphers")]),s._v("  HIGH:!aNULL:!MD5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_protocols")]),s._v(" TLSv1.1 TLSv1.2 TLSv1.3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_prefer_server_ciphers")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /doc/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rewrite")]),s._v(" ^/doc/$ /doc/swagger permanent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\t    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_intercept_errors")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host m-api.luckyzp.top")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto https")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$scheme")]),s._v("\n\t    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://localhost:6001/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("      \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("重启Nginx，浏览器输入域名，可以看到swagger文档了\n"),t("img",{attrs:{src:s.$withBase("/images/dotnet/wx_0705_10.png")}}),s._v("\n大功告成！以上就是在Linux部署.net core的全部教程")])])}),[],!1,null,null,null);t.default=n.exports}}]);