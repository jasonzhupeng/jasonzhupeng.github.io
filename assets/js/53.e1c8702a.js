(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{487:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("🍉 我们知道网站一般有2种访问协议，"),t("strong",[t("code",[s._v("http")]),t("strong",[s._v("和")]),t("code",[s._v("https")])]),s._v("。")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("http")]),s._v("是一个简单的请求-响应协议，http访问的网站通常浏览器会有个感叹号，显示不安全。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("https")]),s._v("是在HTTP的基础上加入"),t("strong",[s._v("SSL")]),s._v("，通过传输加密和身份认证保证传输过程的安全性，访问网站会显示一把锁，显示连接是安全的。")])])]),s._v(" "),t("p",[s._v("配置"),t("strong",[s._v("https")]),s._v("安全通道主要分为购买证书、申请认证、下载证书、上传证书到web服务器、配置站点ssl...")]),s._v(" "),t("p",[s._v("此文以"),t("strong",[s._v("nginx")]),s._v("和"),t("strong",[s._v("阿里云")]),s._v("为例进行讲解。")]),s._v(" "),t("h2",{attrs:{id:"购买ssl证书"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#购买ssl证书"}},[s._v("#")]),s._v(" 购买SSL证书")]),s._v(" "),t("p",[s._v("首先证书分为：单域名、通配符域名、多域名证书")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("单域名")]),s._v("：只能绑定一个域名，例如："),t("mark",[s._v("www.abc.com")]),s._v(" 或 "),t("mark",[s._v("abc.com")]),s._v("。无法绑定子域名")]),s._v(" "),t("li",[t("strong",[s._v("通配符域名")]),s._v("：可以绑定一个主域名和多个子域名，不限个数，例如："),t("mark",[s._v("abc.com")]),s._v("，"),t("mark",[s._v("my.abc.com")]),s._v("，"),t("mark",[s._v("kk.abc.com")]),s._v("...")]),s._v(" "),t("li",[t("strong",[s._v("多域名")]),s._v("：可以绑定不同的域名，可以是主域名也可以是子域名，数量有限制")])]),s._v(" "),t("p",[s._v("阿里云域名账号每年可以免费购买20个证书，有效期为1年")]),s._v(" "),t("p",[t("font",{attrs:{size:"4"}},[s._v("1.进入阿里云控制台=》SSL证书=》免费证书=》立即购买")])],1),s._v(" "),t("img",{attrs:{src:s.$withBase("/images/linux/wx_0425_1.png")}}),s._v("\n点击立即购买即可\n"),t("h2",{attrs:{id:"申请认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#申请认证"}},[s._v("#")]),s._v(" 申请认证")]),s._v(" "),t("p",[t("font",{attrs:{size:"4"}},[s._v("1.进入ssl证书管理页面=》免费证书，可以看到已经有20个创建数量，点击创建证书，列表增加了一个待申请的项")])],1),s._v(" "),t("img",{attrs:{src:s.$withBase("/images/linux/wx_0425_2.png")}}),s._v(" "),t("p",[t("font",{attrs:{size:"4"}},[s._v("2.点击证书申请，填写信息，提交审核")])],1),s._v(" "),t("img",{attrs:{src:s.$withBase("/images/linux/wx_0425_3.png")}}),s._v("\n联系人点击下拉选项先新建联系人，"),t("mark",[s._v("证书绑定域名")]),s._v("必须输入准确的域名，别输错啦；\n"),t("p",[s._v("注意域名验证方式有"),t("mark",[s._v("自动DNS验证")]),s._v("和"),t("mark",[s._v("手动DNS验证")]),s._v("，因为我的是"),t("u",[t("em",[t("strong",[s._v("阿里云服务器默认选自动验证")])])]),s._v("，如果非阿里云服务器，需要手动DNS验证。")]),s._v(" "),t("p",[s._v("信息填写完毕最后提交审核")]),s._v(" "),t("p",[t("font",{attrs:{size:"4"}},[s._v("3.进行DNS验证，如果是手工验证方式需要先到域名控制台配置域名解析")])],1),s._v(" "),t("p",[s._v("第二步提交审核成功后，会出现如下界面\n"),t("img",{attrs:{src:s.$withBase("/images/linux/wx_0425_4.png")}})]),s._v(" "),t("p",[s._v("复制红框处的信息，前往域名控制台配置域名解析，"),t("font",{attrs:{color:"red"}},[s._v("ps:如果是自动DNS验证可以跳过此步骤，系统会自动配置好")]),s._v(" "),t("img",{attrs:{src:s.$withBase("/images/linux/wx_0425_5.png")}})],1),s._v(" "),t("p",[s._v("添加记录成功后，返回证书申请界面点击验证，验证成功，再提交审核\n"),t("img",{attrs:{src:s.$withBase("/images/linux/wx_0425_6.png")}}),s._v("\n成功提交后，静等个几分钟，会邮件通知签发完成，接下来就可以下载证书进行配置了")]),s._v(" "),t("h2",{attrs:{id:"下载证书"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载证书"}},[s._v("#")]),s._v(" 下载证书")]),s._v(" "),t("p",[s._v("回到ssl证书管理列表，找到刚签发成功的证书，点击下载，下载对应的web服务器证书，我这里用的是nginx，我就下载nginx的\n"),t("img",{attrs:{src:s.$withBase("/images/linux/wx_0425_7.png")}})]),s._v(" "),t("p",[s._v("下载的文件为一个压缩包，解压后主要包含2个文件，xxxx.pem，xxx.key\n"),t("img",{attrs:{src:s.$withBase("/images/linux/wx_0425_8.png")}})]),s._v(" "),t("h2",{attrs:{id:"上传证书到web服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#上传证书到web服务器"}},[s._v("#")]),s._v(" 上传证书到Web服务器")]),s._v(" "),t("p",[s._v("登陆Linux定位到nginx的安装目录，找到conf目录，在此目录下新建文件夹cert")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/webserver/nginx/conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" cert\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("使用ftp工具把下载的证书上传到cert目录\n"),t("img",{attrs:{src:s.$withBase("/images/linux/wx_0425_9.png")}}),s._v("\n证书上传完成")]),s._v(" "),t("h2",{attrs:{id:"配置站点ssl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置站点ssl"}},[s._v("#")]),s._v(" 配置站点SSL")]),s._v(" "),t("h3",{attrs:{id:"_1-编辑nginx配置文件nginx-conf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-编辑nginx配置文件nginx-conf"}},[s._v("#")]),s._v(" 1.编辑nginx配置文件nginx.conf")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/webserver/nginx/conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" nginx.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("将原来注释的server listen 443 ssl配置，增加或编辑，改为关联自己的站点，增加新的站点也是按此方式配置")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  www.luckyzp.top")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传的证书的位置")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v("      cert/9806668_www.luckyzp.top.pem")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v("  cert/9806668_www.luckyzp.top.key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssl_session_cache    shared:SSL:1m;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_timeout")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5m")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_ciphers")]),s._v("  HIGH:!aNULL:!MD5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_protocols")]),s._v(" TLSv1.1 TLSv1.2 TLSv1.3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_prefer_server_ciphers")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 站点路径")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v(" /home/wwwroot/myblog/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v("/ /index.html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("autoindex")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("保存修改，运行命令编译，再重启nginx就配置完成了...")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\nnginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" stop\nngix\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("然后我们在浏览器输入地址验证，可以看到网站已经带安全标志了")]),s._v(" "),t("img",{attrs:{src:s.$withBase("/images/linux/wx_0425_10.png")}}),s._v(" "),t("h3",{attrs:{id:"_2-配置http跳转到https"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置http跳转到https"}},[s._v("#")]),s._v(" 2.配置http跳转到https")]),s._v(" "),t("p",[s._v("最后一步还需要把原来的http设置跳转到新的https，我们知道在浏览器输入xxx.com默认访问的是http 80端口，\n跳转到https 443端口，有2种方式，1是使用rewrite重写url，2是通过301重定向到https，这里推荐使用第2种方法")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  luckyzp.top")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将所有HTTP请求通过重定向到HTTPS。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" https://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("OK，全部操作完成了，以上就是设置网站安全认证的全部流程")])])}),[],!1,null,null,null);t.default=e.exports}}]);